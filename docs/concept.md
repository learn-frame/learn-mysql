# 原理

![image.png](https://edge.yancey.app/beg/v25x9ki8-1695707243638.png)

MySQL可以分为 Server 层和存储引擎层两部分.

Server 层包括连接器, 查询缓存, 分析器, 优化器, 执行器等, 涵盖 MySQL 的大多数核心服务功能, 以及所有的内置函数(如日期, 时间, 数学和加密函数等), 所有跨存储引擎的功能都在 这一层实现, 比如存储过程, 触发器, 视图等.

而存储引擎层负责数据的存储和提取. 其架构模式是插件式的, 支持InnoDB, MyISAM,  Memory 等多个存储引擎. 现在最常用的存储引擎是 InnoDB, 它从 MySQL 5.5.5 版本开始成为了默认存储引擎.

## 连接器

用于连接到 MySQL, 支持登录鉴权啥的.

```sql
mysql -h$ip -P$port -u$user -p
```

MySQL 通过 `show processlist` 看看哪个链接是否处于空闲, 客户端如果太长时间没动静, 连接器就会自动将它断开. 这个时间是由参数 `wait_timeout` 控制的, 默认值是 8 小时. 5.7 之后通过 `mysql_reset_connection` 来重新初始化连接资源.

## 查询缓存

`>= 8.0` 已废弃

## 分析器

就是词法分析, 语法分析这些.

## 优化器

优化器是在表里面有多个索引的时候, 决定使用哪个索引; 或者在一个语句有多表关联(join)的时候, 决定各个表的连接顺序. 比如你执行下面这样的语句, 这个语句是执行两个表的 join:

```sql
SELECT
 * 
FROM
 t1
 JOIN t2 USING ( ID ) 
WHERE
 t1.c = 10 
 AND t2.d = 20;
```

- 既可以先从表 t1 里面取出 c=10 的记录的 ID 值, 再根据 ID 值关联到表 t2, 再判断 t2 里面 d 的值是否等于 20.
- 也可以先从表 t2 里面取出 d=20 的记录的 ID 值, 再根据 ID 值关联到 t1, 再判断 t1 里面 c 的值是否等于 10.

这两种执行方法的逻辑结果是一样的, 但是执行的效率会有不同, 而优化器的作用就是决定选择使用哪一个方案.

## 执行器

首先判断对你要操作的表是否有权限, 如果没有, 就会返回没有权限的错误. 否则就是执行了.
